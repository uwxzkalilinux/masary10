<body>
  <!-- โ ุงูุตูุฑุฉ ุงูุนุดูุงุฆูุฉ ูู ุงูุฃุนูู -->
  <img id="randomImage" src="" alt="ุตูุฑุฉ ุนุดูุงุฆูุฉ" />

  <h1>ุงุณุชุนูุงู ุนู ูุนูููุงุช ุงููุฑูุจุฉ</h1>
  <input type="text" id="uniqueId" placeholder="ุงุฏุฎู ุงูุฑูู ุงูููุญุฏ" />
  <button onclick="fetchData()">ุฌูุจ ุงููุนูููุงุช</button>
  <div class="stats" id="stats"></div>

  <div class="container">
    <div class="column">
      <h3>๐ซ ุณูุงุฑุงุช ุจุฏูู ุณููุงุฑ</h3>
      <div class="info" id="withoutSonar"></div>
    </div>
    <div class="column">
      <h3>โ ุณูุงุฑุงุช ุจููุง ุณููุงุฑ</h3>
      <div class="info" id="withSonar"></div>
    </div>
  </div>

  <script>
    async function fetchData() {
      const id = document.getElementById("uniqueId").value;
      const withoutSonar = document.getElementById("withoutSonar");
      const withSonar = document.getElementById("withSonar");
      const stats = document.getElementById("stats");
      const image = document.getElementById("randomImage");

      withoutSonar.innerHTML = "ุฌุงุฑู ุงูุชุญููู...";
      withSonar.innerHTML = "";
      stats.innerHTML = "";

      try {
        const res = await fetch("/api/proxy?unique=" + id);
        const data = await res.json();

        if (data.trips && data.trips.length > 0) {
          let withSonarList = [];
          let withoutSonarList = [];

          data.trips.forEach(trip => {
            const hasSonar = trip.sonarData?.manifests?.length > 0;
            const infoHTML = `
              <p><strong>ุฑูู ุงูุณูุงุฑุฉ:</strong> ${trip.truck_number}</p>
              <p><strong>ุฑูู ุงูุณุงุฆู:</strong> ${trip.driver}</p>
              <p><strong>ุฑูู ุงูุญุงููุฉ:</strong> ${trip.container_number}</p>
              <p><strong>ุงูููุงููุณุช:</strong> ${hasSonar ? "ุจููุง ุตูุฑ ุณููุงุฑ" : "ุงูุณูุงุฑุฉ ูุงุจููุฉ ุณููุงุฑ"}</p>
              <hr />
            `;
            hasSonar ? withSonarList.push(infoHTML) : withoutSonarList.push(infoHTML);
          });

          stats.innerHTML = `ุนุฏุฏ ุงูุณูุงุฑุงุช ุงูุชู ุจููุง ุณููุงุฑ: ${withSonarList.length} | ุนุฏุฏ ุงูุณูุงุฑุงุช ุงูุชู ูุง ุชุญุชูู ุนูู ุณููุงุฑ: ${withoutSonarList.length}`;
          withoutSonar.innerHTML = withoutSonarList.join('');
          withSonar.innerHTML = withSonarList.join('');

          // โ ุตูุฑุฉ ุนุดูุงุฆูุฉ
          const randomIndex = Math.floor(Math.random() * 5) + 1;
          image.src = `/img${randomIndex}.jpg`;
          image.style.display = "block";
        } else {
          withoutSonar.innerHTML = "ูุง ุชูุฌุฏ ูุนูููุงุช ูุชุงุญุฉ ููุฐุง ุงูุฑูู.";
        }
      } catch (error) {
        withoutSonar.innerHTML = "ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฌูุจ ุงูุจูุงูุงุช: " + error;
      }
    }
  </script>
</body>
