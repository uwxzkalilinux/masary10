<body>
  <!-- ✅ صورة عشوائية -->
  <img id="randomImage" src="" alt="صورة عشوائية" style="width: 250px; border-radius: 10px; margin-bottom: 1rem; box-shadow: 0 0 10px rgba(0,0,0,0.15);" />

  <img src="/logo.jpg" alt="شعار الموقع" width="150" />
  <h1>استعلام عن معلومات مساري علي ناصر</h1>
  <input type="text" id="uniqueId" placeholder="ادخل الرقم الموحد" />
  <button onclick="fetchData()">جلب المعلومات</button>
  <div class="stats" id="stats"></div>
  <div class="columns">
    <div class="column" id="withoutSonarColumn">
      <h2>🚫 بدون سونار</h2>
    </div>
    <div class="column" id="withSonarColumn">
      <h2>✅ بيها سونار</h2>
    </div>
  </div>

  <script>
    function showRandomImage() {
      const image = document.getElementById("randomImage");
      const index = Math.floor(Math.random() * 5) + 1;
      image.src = `/img${index}.jpg`; // تأكد إن الصور موجودة: img1.jpg, img2.jpg, ...
    }

    async function fetchData() {
      const id = document.getElementById("uniqueId").value;
      const stats = document.getElementById("stats");
      const withSonarCol = document.getElementById("withSonarColumn");
      const withoutSonarCol = document.getElementById("withoutSonarColumn");

      withSonarCol.innerHTML = "<h2>✅ بيها سونار</h2>";
      withoutSonarCol.innerHTML = "<h2>🚫 بدون سونار</h2>";
      stats.innerHTML = "جارٍ التحميل...";

      // ✅ عرض صورة عشوائية
      showRandomImage();

      try {
        const res = await fetch("/api/proxy?unique=" + id);
        const data = await res.json();

        if (data.trips && data.trips.length > 0) {
          let withSonarCount = 0;
          let withoutSonarCount = 0;

          data.trips.forEach(trip => {
            const hasSonar = trip.sonarData?.manifests?.length > 0;
            const infoHTML = `
              <p><strong>رقم السيارة:</strong> ${trip.truck_number}</p>
              <p><strong>رقم السائق:</strong> ${trip.driver}</p>
              <p><strong>رقم الحاوية:</strong> ${trip.container_number}</p>
              <hr />
            `;
            if (hasSonar) {
              withSonarCol.innerHTML += infoHTML;
              withSonarCount++;
            } else {
              withoutSonarCol.innerHTML += infoHTML;
              withoutSonarCount++;
            }
          });

          stats.innerHTML = `عدد السيارات التي بيها سونار: ${withSonarCount} | عدد السيارات التي لا تحتوي على سونار: ${withoutSonarCount}`;
        } else {
          stats.innerHTML = "لا توجد معلومات متاحة لهذا الرقم.";
        }
      } catch (error) {
        stats.innerHTML = "حدث خطأ أثناء جلب البيانات: " + error;
      }
    }
  </script>
</body>
